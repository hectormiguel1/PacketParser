#include <iostream>
#include "parser.h"

static const unsigned char pkt15[648] = {
        0x62, 0x38, 0xe0, 0xcd, 0x42, 0x80, 0x04, 0xd9, /* b8..B... */
        0xf5, 0x7e, 0xeb, 0xc1, 0x08, 0x00, 0x45, 0x00, /* .~....E. */
        0x02, 0x7a, 0x47, 0xf8, 0x40, 0x00, 0x40, 0x06, /* .zG.@.@. */
        0x49, 0x2a, 0xc0, 0xa8, 0x01, 0xee, 0xa5, 0xc1, /* I*...... */
        0x3f, 0x04, 0x80, 0x1c, 0x2e, 0xe0, 0x72, 0xbb, /* ?.....r. */
        0x25, 0x62, 0xfb, 0xcb, 0x86, 0xc9, 0x80, 0x18, /* %b...... */
        0x01, 0xf6, 0xa9, 0xc8, 0x00, 0x00, 0x01, 0x01, /* ........ */
        0x08, 0x0a, 0x14, 0xa3, 0x45, 0x95, 0xb5, 0x6f, /* ....E..o */
        0xd0, 0x79, 0x0d, 0xf0, 0x42, 0x02, 0x00, 0x00, /* .y..B... */
        0x00, 0x00, 0x07, 0x1b, 0x3d, 0x02, 0x69, 0x00, /* ....=.i. */
        0x5e, 0xc1, 0x91, 0xdc, 0xc4, 0xe4, 0x51, 0xec, /* ^.....Q. */
        0xbd, 0x36, 0x46, 0x22, 0xa9, 0x1c, 0xf5, 0xf5, /* .6F".... */
        0x92, 0xd2, 0x6c, 0x1b, 0xcc, 0x09, 0x9f, 0x02, /* ..l..... */
        0x09, 0xd6, 0x57, 0x3a, 0x77, 0xcd, 0x6b, 0x58, /* ..W:w.kX */
        0xe3, 0x93, 0xb9, 0x69, 0x0e, 0xcf, 0xcd, 0x0c, /* ...i.... */
        0x09, 0x46, 0x4a, 0x6b, 0x9e, 0x69, 0xd0, 0xc7, /* .FJk.i.. */
        0xf4, 0x39, 0x4b, 0x92, 0x77, 0x74, 0xc0, 0x39, /* .9K.wt.9 */
        0x50, 0x01, 0xfc, 0xed, 0xef, 0x83, 0x5c, 0x29, /* P.....\) */
        0x9f, 0x7f, 0xaa, 0x05, 0xa3, 0x36, 0x93, 0xb4, /* .....6.. */
        0xf0, 0x13, 0x3e, 0xa8, 0x29, 0x87, 0xdf, 0xb6, /* ..>.)... */
        0xf5, 0x42, 0xc2, 0xc4, 0x12, 0xfd, 0xcb, 0xf6, /* .B...... */
        0xf7, 0x11, 0x76, 0x28, 0x7b, 0xa3, 0x97, 0x67, /* ..v({..g */
        0xa3, 0x2f, 0x0f, 0x71, 0xc1, 0xe5, 0x59, 0x04, /* ./.q..Y. */
        0x1b, 0x0a, 0x00, 0x57, 0x2e, 0x31, 0x2e, 0x34, /* ...W.1.4 */
        0x32, 0x30, 0x2e, 0x31, 0x33, 0x14, 0x00, 0x72, /* 20.13..r */
        0x36, 0x38, 0x32, 0x36, 0x34, 0x32, 0x2e, 0x57, /* 682642.W */
        0x69, 0x7a, 0x61, 0x72, 0x64, 0x5f, 0x31, 0x5f, /* izard_1_ */
        0x34, 0x32, 0x30, 0x14, 0x00, 0x72, 0x36, 0x38, /* 420..r68 */
        0x32, 0x36, 0x34, 0x32, 0x2e, 0x57, 0x69, 0x7a, /* 2642.Wiz */
        0x61, 0x72, 0x64, 0x5f, 0x31, 0x5f, 0x34, 0x32, /* ard_1_42 */
        0x30, 0x48, 0x01, 0x31, 0x3d, 0x33, 0x32, 0x30, /* 0H.1=320 */
        0x33, 0x35, 0x36, 0x34, 0x39, 0x36, 0x30, 0x2c, /* 3564960, */
        0x32, 0x3d, 0x32, 0x31, 0x30, 0x39, 0x35, 0x33, /* 2=210953 */
        0x35, 0x30, 0x37, 0x30, 0x2c, 0x35, 0x3d, 0x32, /* 5070,5=2 */
        0x38, 0x37, 0x34, 0x37, 0x30, 0x33, 0x35, 0x30, /* 87470350 */
        0x34, 0x2c, 0x37, 0x3d, 0x33, 0x31, 0x33, 0x34, /* 4,7=3134 */
        0x33, 0x37, 0x34, 0x36, 0x34, 0x36, 0x2c, 0x38, /* 374646,8 */
        0x3d, 0x32, 0x38, 0x35, 0x34, 0x34, 0x31, 0x32, /* =2854412 */
        0x31, 0x36, 0x38, 0x2c, 0x39, 0x3d, 0x32, 0x31, /* 168,9=21 */
        0x36, 0x32, 0x37, 0x31, 0x30, 0x32, 0x31, 0x30, /* 62710210 */
        0x2c, 0x31, 0x32, 0x3d, 0x31, 0x32, 0x32, 0x37, /* ,12=1227 */
        0x31, 0x34, 0x34, 0x36, 0x39, 0x35, 0x2c, 0x31, /* 144695,1 */
        0x35, 0x3d, 0x31, 0x39, 0x36, 0x30, 0x31, 0x39, /* 5=196019 */
        0x31, 0x36, 0x38, 0x39, 0x2c, 0x31, 0x36, 0x3d, /* 1689,16= */
        0x37, 0x33, 0x31, 0x34, 0x33, 0x36, 0x39, 0x32, /* 73143692 */
        0x39, 0x2c, 0x31, 0x39, 0x3d, 0x34, 0x30, 0x39, /* 9,19=409 */
        0x30, 0x35, 0x34, 0x34, 0x30, 0x37, 0x39, 0x2c, /* 0544079, */
        0x32, 0x35, 0x3d, 0x34, 0x31, 0x38, 0x31, 0x37, /* 25=41817 */
        0x36, 0x38, 0x38, 0x32, 0x33, 0x2c, 0x34, 0x30, /* 68823,40 */
        0x3d, 0x32, 0x33, 0x30, 0x30, 0x37, 0x34, 0x31, /* =2300741 */
        0x36, 0x37, 0x38, 0x2c, 0x34, 0x31, 0x3d, 0x32, /* 678,41=2 */
        0x33, 0x33, 0x37, 0x37, 0x37, 0x37, 0x32, 0x33, /* 33777723 */
        0x38, 0x2c, 0x34, 0x32, 0x3d, 0x31, 0x36, 0x35, /* 8,42=165 */
        0x37, 0x39, 0x33, 0x31, 0x38, 0x30, 0x2c, 0x34, /* 793180,4 */
        0x33, 0x3d, 0x31, 0x37, 0x34, 0x39, 0x36, 0x39, /* 3=174969 */
        0x36, 0x31, 0x35, 0x33, 0x2c, 0x34, 0x34, 0x3d, /* 6153,44= */
        0x31, 0x39, 0x32, 0x32, 0x30, 0x38, 0x32, 0x34, /* 19220824 */
        0x35, 0x35, 0x2c, 0x34, 0x35, 0x3d, 0x32, 0x34, /* 55,45=24 */
        0x30, 0x35, 0x37, 0x34, 0x38, 0x33, 0x39, 0x35, /* 05748395 */
        0x2c, 0x34, 0x36, 0x3d, 0x31, 0x36, 0x37, 0x34, /* ,46=1674 */
        0x30, 0x39, 0x35, 0x33, 0x36, 0x38, 0x2c, 0x34, /* 095368,4 */
        0x37, 0x3d, 0x31, 0x36, 0x38, 0x39, 0x31, 0x35, /* 7=168915 */
        0x30, 0x33, 0x33, 0x30, 0x2c, 0x35, 0x30, 0x3d, /* 0330,50= */
        0x33, 0x39, 0x32, 0x35, 0x34, 0x31, 0x34, 0x38, /* 39254148 */
        0x39, 0x39, 0x2c, 0x35, 0x31, 0x3d, 0x31, 0x36, /* 99,51=16 */
        0x35, 0x36, 0x38, 0x33, 0x38, 0x30, 0x35, 0x38, /* 56838058 */
        0x2c, 0x35, 0x32, 0x3d, 0x31, 0x34, 0x39, 0x34, /* ,52=1494 */
        0x32, 0x32, 0x39, 0x38, 0x31, 0x31, 0x2c, 0x35, /* 229811,5 */
        0x33, 0x3d, 0x34, 0x30, 0x38, 0x39, 0x30, 0x36, /* 3=408906 */
        0x37, 0x38, 0x31, 0x35, 0x2c, 0x35, 0x34, 0x3d, /* 7815,54= */
        0x32, 0x37, 0x36, 0x32, 0x35, 0x39, 0x37, 0x32, /* 27625972 */
        0x39, 0x32, 0x2c, 0x59, 0xa3, 0x89, 0x1a, 0x93, /* 92,Y.... */
        0x5a, 0x00, 0x00, 0x07, 0x00, 0x45, 0x6e, 0x67, /* Z....Eng */
        0x6c, 0x69, 0x73, 0x68, 0x35, 0x00, 0x7b, 0x42, /* lish5.{B */
        0x46, 0x34, 0x39, 0x31, 0x45, 0x38, 0x42, 0x2d, /* F491E8B- */
        0x38, 0x43, 0x30, 0x35, 0x2d, 0x34, 0x34, 0x36, /* 8C05-446 */
        0x39, 0x2d, 0x42, 0x32, 0x33, 0x35, 0x2d, 0x34, /* 9-B235-4 */
        0x33, 0x45, 0x36, 0x30, 0x33, 0x45, 0x39, 0x39, /* 3E603E99 */
        0x45, 0x33, 0x45, 0x7d, 0x3a, 0x7b, 0x48, 0x57, /* E3E}:{HW */
        0x2d, 0x49, 0x44, 0x2d, 0x53, 0x4d, 0x42, 0x49, /* -ID-SMBI */
        0x4f, 0x53, 0x7d, 0x00, 0x00, 0x00, 0x00, 0x00  /* OS}..... */
};
int main() {
    parser packetParser = parser((void *) pkt15, sizeof(pkt15));
    auto [error_code, testByte1] = packetParser.readByte();
    auto [error_code2, testByte2] = packetParser.readByte();
    while(packetParser.getLengthRemaining() > 0 &  error_code2 <= NO_ERROR &
    testByte1 != byte('\r') & testByte2 != byte('\xf0')){
        testByte1 = get<byte>(packetParser.readByte());
        auto [error_code3,byte3] = packetParser.readByte();
        error_code2 = error_code3;
        testByte2 = byte3;


        cout << "Test Byte 1: " << hex << (char)testByte1 << endl;
        cout << "Test Byte 2: " << hex << (char)testByte2 << endl;

        cout << "Remaining Packet size: " << dec << packetParser.getLengthRemaining() << endl;
    }
    cout << "Remaining Packet size: " << dec << packetParser.getLengthRemaining() << endl;

    while(packetParser.getLengthRemaining() > 0)
    {
        if (packetParser.getLengthRemaining() < 4)
        {
            cout << "Last Packet" << endl;
        }
        packetParser.readN(4);
        cout << "Read Short: " << get<short>(packetParser.readShort()) << endl;
        auto [_error_code, length] = packetParser.readUShort();
        if(length > packetParser.getLengthRemaining())
        {
            cout << "Last Packet!" << endl;
        }
        packetParser.readN(length);
        cout << "Remaining Packet size: " << dec << packetParser.getLengthRemaining() << endl;
        auto [error_code,control] = packetParser.readByte();
        auto [__error_code, opCode] = packetParser.readByte();
        auto [___error_code, unkown] = packetParser.readShort();

        if (control != 0)
    }

}